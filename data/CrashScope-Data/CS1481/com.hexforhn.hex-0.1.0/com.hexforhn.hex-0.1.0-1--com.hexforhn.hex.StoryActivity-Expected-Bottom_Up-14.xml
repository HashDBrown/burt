<?xml version='1.0' encoding='UTF-8' standalone='yes' ?><hierarchy rotation="0"><node index="0" text="" resource-id="" class="android.widget.FrameLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][1080,1794]"><node index="0" text="" resource-id="" class="android.widget.LinearLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][1080,1794]"><node index="0" text="" resource-id="" class="android.widget.FrameLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,63][1080,1794]"><node index="0" text="" resource-id="com.hexforhn.hex:id/action_bar_root" class="android.widget.LinearLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,63][1080,1794]"><node index="0" text="" resource-id="android:id/content" class="android.widget.FrameLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,63][1080,1794]"><node index="0" text="" resource-id="" class="android.widget.LinearLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,63][1080,1794]"><node index="0" text="" resource-id="" class="android.widget.LinearLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,63][1080,336]"><node index="0" text="" resource-id="com.hexforhn.hex:id/toolbar" class="android.view.ViewGroup" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,63][1080,210]"><node index="0" text="" resource-id="" class="android.widget.ImageButton" package="com.hexforhn.hex" content-desc="Navigate up" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,63][147,210]" /><node index="1" text="tolower() in bulk at speed" resource-id="" class="android.widget.TextView" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[157,101][757,172]" /><node index="2" text="" resource-id="" class="android.support.v7.widget.LinearLayoutCompat" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[954,63][1080,210]"><node index="0" text="" resource-id="com.hexforhn.hex:id/action_share" class="android.widget.TextView" package="com.hexforhn.hex" content-desc="Share" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="true" password="false" selected="false" bounds="[954,73][1080,199]" /></node></node><node index="1" text="" resource-id="com.hexforhn.hex:id/tabs" class="android.widget.HorizontalScrollView" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,210][1080,336]"><node index="0" text="" resource-id="" class="android.widget.LinearLayout" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,210][1080,336]"><node index="0" text="" resource-id="" class="android.support.v7.app.ActionBar$Tab" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="true" bounds="[0,210][540,336]"><node index="0" text="Article" resource-id="" class="android.widget.TextView" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="true" bounds="[198,247][342,298]" /></node><node index="1" text="" resource-id="" class="android.support.v7.app.ActionBar$Tab" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[540,210][1080,336]"><node index="0" text="Comments" resource-id="" class="android.widget.TextView" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[708,247][912,298]" /></node></node></node></node><node index="1" text="" resource-id="com.hexforhn.hex:id/pager" class="android.support.v4.view.ViewPager" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="true" focused="false" scrollable="true" long-clickable="false" password="false" selected="false" bounds="[0,336][1080,1794]"><node index="0" text="" resource-id="com.hexforhn.hex:id/webview_layout" class="android.view.ViewGroup" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,336][1080,1794]"><node index="0" text="" resource-id="" class="android.webkit.WebView" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,336][1080,1794]"><node index="0" text="" resource-id="" class="android.webkit.WebView" package="com.hexforhn.hex" content-desc="tolower() in bulk at speed – Tony Finch" checkable="false" checked="false" clickable="false" enabled="true" focusable="true" focused="true" scrollable="true" long-clickable="false" password="false" selected="false" bounds="[0,336][1080,1794]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc=".@ Tony Finch – blog" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,378][1039,669]" /><node index="1" text="" resource-id="" class="android.widget.ListView" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,711][1039,811]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,711][149,761]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="home" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,711][149,761]" /></node><node index="1" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[157,711][246,761]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="links" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[157,711][246,761]" /></node><node index="2" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[254,711][375,761]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="twitter" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[254,711][375,761]" /></node><node index="3" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="blog" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[383,711][467,761]" /><node index="4" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="—" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[475,711][511,761]" /><node index="5" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[519,711][829,761]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="archive contents" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[519,711][829,761]" /></node><node index="6" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,761][299,811]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="recent entries" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,761][299,811]" /></node><node index="7" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[307,761][498,811]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="atom feed" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[307,761][498,811]" /></node></node><node index="2" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[63,900][1018,1099]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="2022-06-27 – tolower() in bulk at speed" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[63,900][1010,1099]" /></node><node index="3" text="" resource-id="" class="android.widget.ListView" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,1141][1039,1202]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,1141][273,1186]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="⇐ 2022-06-22 ⫤" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[42,1147][273,1183]" /></node><node index="1" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc=" " checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[312,1165][900,1202]" /><node index="2" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[939,1141][1039,1186]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="⊨ ☆ ⇒" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[939,1147][1039,1183]" /></node></node><node index="4" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="Here’s a fun bit of Monday optimization." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[84,1228][997,1278]" /><node index="5" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="DNS servers often have to convert DNS names to their canonical lower case form. BIND has to do so a bit more than most because it tries to preserve the case of DNS names rather than canonicalizing them." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[84,1320][997,1569]" /><node index="6" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="I was recently distracted by a cleanup oportunity: there were multiple maptolower lookup tables in BIND, so I decided to make a home for them so that we would only need one copy. Then I thought, surely there are faster ways to implement tolower() than a lookup table." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[84,1611][997,1794]" /><node index="7" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="SIMD within a register" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="8" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="There’s an amazing amount of space in a 64-bit register for crunching data in parallel. Many years ago I wrote about a bitsliced " checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="1" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="Life In A Register" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="2" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc=", my link log has " checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="3" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="a collection of web pages about bit twiddling hacks" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="4" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc=", and my shelves are graced by a copy of " checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="5" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="Hacker’s Delight" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="6" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /></node><node index="9" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="Code often needs to work with DNS names one label at a time (the labels are the dot-separated parts), and labels are frequently less than 8 bytes long, and therefore fit inside a 64-bit register. So it probably isn’t worth dealing with the portability issues of working with wide vector registers. (Especially since I could not find a quick way to load an arbitrary number of bytes into a vector register with AVX2 nor with NEON.)" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="10" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="bytewise parallel tolower()" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="11" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="Hacker’s Delight" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="1" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc=" has a lot of discussion of this kind of SWAR string processing code, but it does not directly tackle " checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="2" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="tolower()" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="3" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc=". So, here’s how I adapted Hank Warren’s examples for my purposes." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /></node><node index="12" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="Our function is going to work on 8 ASCII bytes packed into a uint64_t." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="13" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="uint64_t tolower8(uint64_t octets) {&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="14" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="For readability, it’s helpful to be able to replicate a single-byte value to all 8 bytes in a word. To do so we can multiply by a constant that has a 1 in each byte. The compiler’s constant propagation and instruction selection will make this efficient for us." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="15" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t all_bytes = 0x0101010101010101;&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="16" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="We are going to steal the 0x80 bit in each byte to use as a flag for various purposes." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="17" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t heptets = octets &amp; (0x7F * all_bytes);&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="18" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="The main trick we’ll use from Hank Warren is how to find out which bytes are greater than a particular constant, such as 'Z'. If we add 0x7Fto any of our bytes, carries will propagate and the result will overflow into our 0x80 flag bit only if the byte is greater than zero. And because we cleared the flag bits, they act as fire breaks stopping the carries from lower bytes messing up the calculations for higher bytes." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="19" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="To compare with a value other than zero, we can subtract it from 0x7F:" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="20" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t is_gt_Z = heptets + (0x7F - 'Z') * all_bytes;&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="21" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="To do a greater-than-or-equal comparison, we just need to add 1:" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="22" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t is_ge_A = heptets + (0x80 - 'A') * all_bytes;&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="23" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="The flags we just calculated are only valid if the corresponding octet is in the ASCII range of 0 to 127. So we need a clear flag for each byte that is 128 or greater." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="24" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t is_ascii = ~octets;&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="25" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="We are now ready to identify which bytes contain upper case ASCII letters:" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="26" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t is_upper = is_ascii &amp; (is_ge_A ^ is_gt_Z);&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="27" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="The difference between corresponding upper case and lower case letters in ASCII is 32, aka 0x20. So to get our conversion value, we need to move our 0x80 flag bits to 0x20, and clear out the junk that our calculations left behind in the other bits:" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="28" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t to_lower = (is_upper &gt;&gt; 2) &amp; (0x20 * all_bytes);&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="29" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="All that’s left is to add our flag bits to the original word, so that each byte that was an ASCII upper case letter has 32 added to change it to lower case." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="30" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    return (octets | to_lower);&#10;}&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="31" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="That should compile down to about 9 instructions, which is not much more than one instruction per byte. And these are the fastest kinds of instructions :-)" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="32" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="edited to add" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="33" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="We can reduce the critical path from 7 to 6 instructions with a slight adjustment: changeis_ascii and the return value as follows, and delete to_lower." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="34" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    uint64_t is_ascii = ~octets &amp; (0x80 * all_bytes);&#10;    return (octets | is_upper &gt;&gt; 2);&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="35" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="performance numbers" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="36" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="I ran some basic benchmarks on a million random bytes to see how this code compares to one-byte-at-a-time tolower():" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="37" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="    0.098 ms memmove() copy&#10;    0.399 ms tolower8() copy&#10;    1.817 ms tolower() copy&#10;    0.280 ms tolower8() compare&#10;    2.090 ms tolower() compare&#10;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="38" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="The copy lines are for making a new lower-case version of the string. The compare lines are for testing two strings for case-insensitive equality." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="39" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="My tolower8() function is at its best when it has a lot to chew on; it is not so good for really short strings. The crossover point, when comparing two strings, is about 4 characters - conveniently, the same length as .com. (There is a trick for 4-character strings: load them both into the same register so they can both be converted to lower case at the same time.)" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="40" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="So now you know how to convert strings to lower case at gigabytes per second in a single thread." checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="41" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="⇐ 2022-06-22 ⇐ Compacting a qp-trie ⇐" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="42" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="⇒ ☆ ⇒ ☆ ⇒" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="43" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]"><node index="0" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="Tony Finch" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="1" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="&lt;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="2" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="dot@dotat.at" checkable="false" checked="false" clickable="true" enabled="true" focusable="true" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /><node index="3" text="" resource-id="" class="android.view.View" package="com.hexforhn.hex" content-desc="&gt;" checkable="false" checked="false" clickable="true" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /></node></node></node></node></node></node></node></node></node></node><node index="1" text="" resource-id="android:id/statusBarBackground" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][1080,63]" /><node index="2" text="" resource-id="android:id/navigationBarBackground" class="android.view.View" package="com.hexforhn.hex" content-desc="" checkable="false" checked="false" clickable="false" enabled="true" focusable="false" focused="false" scrollable="false" long-clickable="false" password="false" selected="false" bounds="[0,0][0,0]" /></node></hierarchy>